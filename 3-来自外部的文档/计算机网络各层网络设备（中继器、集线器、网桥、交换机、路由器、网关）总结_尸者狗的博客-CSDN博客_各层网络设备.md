[计算机网络](https://so.csdn.net/so/search?q=%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C&spm=1001.2101.3001.7020)中，有几个通信设备或者说网络设备名词出现的频率相当的高，它们是：中继器、集线器、网桥、交换机、路由器和网关。现在梳理一下它们各自的含义和作用，以及它们之间的联系。这些网络设备对于实际工作中并不全面，比如现在已经出现了三层交换机、四层交换机，但是理念是基本共通的。  

首先回顾下OSI七层模型  
![](https://img-blog.csdnimg.cn/2020080702441198.png?)
  
OSI分层（7层）：物理层，数据链路层，网络层，传输层，会话层，表示层，应用层。  
TCP/IP分层（4层）：网络接口层，网际层，运输层，应用层  
五层协议（5层）：物理层，数据链路层，网络层，运输层，应用层


*   [OSI七层模型](#OSI_2)
*   [物理层设备](#_8)
*   *   [中继器](#_9)
    *   *   [问题：中继器是否可以无限使用？](#_18)
    *   [集线器](#_22)
    *   *   [问题：连接到一台集线器的多台计算机如何工作](#_31)
*   [数据链路层设备](#_35)
*   *   [网桥](#_36)
    *   *   [网桥的缺点](#_45)
        *   [网桥的分类](#_52)
    *   [局域网（以太网）交换机](#_56)
    *   *   [局域网（以太网）交换机原理](#_60)
        *   [以太网交换机的特点](#_64)
        *   [以太网交换机的两种交换模式](#_75)
*   [网络层设备](#_80)
*   *   [路由器](#_81)
    *   *   [路由器的体系结构](#_91)
        *   [转发和路由选择的区别](#_99)
        *   [网桥和路由器的区别](#_104)
*   [网络层之上的设备：网关](#_110)
*   [网络设备常见问题](#_128)
*   *   [设备是否能分离广播域或冲突域的问题](#_129)
    *   [交换机和路由器的区别](#_132)
    *   [为什么有时候还要在路由器的后面先接1台交换机再接计算机](#1_149)


## 物理层设备
## 中继器
------------------------------------------------------------------------------------------

![](https://img-blog.csdnimg.cn/20200807174233811.png?)

中继器（RP repeater）又称转发器，主要功能是将**信号整形**并**放大**再**转发**出去，以消除信号经过一长段电缆后，因噪声或其他原因而造成的失真和衰减，使信号的波形和强度达到所需要的要求，进而扩大网络传输的距离。  
原理  
信号再生（**而非简单地将衰减的信号放大**）。中继器有两个端口，数据从一个端口输入，再从另一个端口发出。端口仅作用于信号的电气部分，而不管数据中是否有错误数据或不适于网段的数据。  
中继器是局域网环境下用来扩大网络规模的最简单、最廉价的互联设备。**使用中继器连接的几个网段仍然是一个局域网。**一般情况下，中继器的**两端连接的是相同的媒体**，但有的中继器也可以完成不同媒体的转接工作。但由于中继器工作在物理层，因此它**不能连接两个具有不同速率的局域网**。中继器两端的网络部分是网段，而不是子网。中继器若出现故障，对相邻两个网段的工作都将产生影响。  
它属于一种模拟设备，用于连接两根电缆段。中继器不理解帧、分组和头的概念，他们只理解电压值。

### 问题：中继器是否可以无限使用？

> 在采用粗同轴电缆的10BASE5 以太网规范中，互相串联的中继器的个数不能超过4 个，而且用4 个中继器串联的5 段通信介质中只有3段可以挂接计算机，其余两段只能用作扩展通信范围的链路段，不能挂接计算机。这就是"5-4-3 规则”

集线器
---

![](https://img-blog.csdnimg.cn/20200807174256338.png?)

*   集线器(Hub) 实质上是一个多端口的中继器，它也工作在物理层。当Hub工作时，一个端口接收到数据信号后，由于信号在从端口到Hub 的传输过程中已有衰减，所以Hub便将该信号进行整形放大，使之再生（恢复）到发送时的状态，紧接着**转发到其他所有**（除输入端口外）处于工作状态的端口。如果同时有两个或多个端口输入，那么输出时会发生冲突，致使这些数据都无效。从Hub 的工作方式可以看出，它在网络中只起信号放大和转发作用，目的是扩大网络的传输范围，而不具备信号的定向传送能力，即信号传输的方向是固定的，是一个标准的共享式设备。
    
*   Hub 主要使用双绞线组建共享网络，是从服务器连接到桌面的最经济方案。在交换式网络中，Hub 直接与交换机相连，将交换机端口的数据送到桌面上。使用Hub 组网灵活，它把所有结点的通信集中在以其为中心的结点上，对结点相连的工作站进行集中管理，不让出问题的工作站影响整个网络的正常运行，并且用户的加入和退出也很自由。
    
*   由Hub组成的网络是共享式网络，但**逻辑上仍是一个总线网**。Hub的每个端口连接的网络部分是同一个网络的不同网段。同时Hub也只能在半双工状态下工作，网络的吞吐率因而受到限制。
    

### 问题：连接到一台集线器的多台计算机如何工作

> 多台计算机必然会发生同时通信的情形，因此集线器不能分割冲突域，所有集线器的端口都属于同一个冲突域。集线器在一个时钟周期中只能传输一组信息，如果一台集线器连接的机器数目较多，且多台机器经常需要同时通信，那么将导致信息碰撞，使得集线器的工作效率很差。比如，一个带宽为10Mb/s的集线器上连接了8 台计算机，当这8 台计算机同时工作时，每台计算机真正所拥有的带宽为10/8Mb/s = 1.25Mb/s 。

# 数据链路层设备
网桥
--------------------------------------------------------------------------------

![](https://img-blog.csdnimg.cn/20200807174341216.png?)

网桥(Bridge)是一个局域网与另一个局域网之间建立连接的桥梁。是早期的**两端口二层网络设备**。网桥的两个端口分别有一条独立的交换信道，不是共享一条背板总线，可隔离冲突域。网桥比集线器（Hub）性能更好，集线器上各端口都是共享同一条背板总线的。后来，网桥被具有更多端口、同时也可隔离冲突域的交换机（Switch）所取代。

> 虽然网桥和集线器长得很像，但是网桥处理数据的对象是帧，所以它是工作在数据链路层的设备，中继器、放大器处理数据的对象是电气信号，所以它是工作在物理层的设备。

两个或多个以太网通过网桥连接后，就成为一个覆盖范围更大的以太网，而原来的每个以太网就称为一个网段。网桥工作在链路层的MAC子层，可以**使以太网各网段成为隔离开的冲突域**。如果把网桥换成工作在物理层的转发器，那么就没有这种过滤通信量的功能。由于各网段相对独立，因此一个网段的故障不会影响到另一个网段的运行。

### 网桥的缺点

1.  增大了时延（存储转发）ø
2.  MAC子层没有流量控制功能（流量控制要用到编号机制，编号机制的实现在LLC子层）
3.  不同的MAC子层的网段桥接在一起时，需要进行帧格式的转换
4.  网桥只适合用户数不多和通信量不大的局域网，否则有时还会因传播过多的广播信息而产生网络拥塞，这就是所谓的**网络风暴**

### 网桥的分类

*   使用源路由网桥可以利用最佳路由。若在两个以太网之间使用并联的源路由网桥，则还可使通信量较平均地分配给每个网桥。
    
*   采用透明网桥时，只能使用生成树，而使用生成树一般并不能保证所用的路由是最佳的，也不能在不同的链路中进行负载均衡。
    

局域网（以太网）交换机
-----------

![](https://img-blog.csdnimg.cn/20200807174406530.png?)
  
桥接器的主要限制是在任一时刻通常只能执行一个帧的转发操作，于是出现了局域网交换机，又称以太网交换机。从本质上说，以太网交换机是一个**多端口的网桥**，它工作在数据链路层。交换机能经济地将网络**分成小的冲突域**，为每个工作站提供更高的带宽。以太网交换机对工作站是透明的，因此管理开销低廉，简化了网络结点的增加、移动和网络变化的操作。

### 局域网（以太网）交换机原理

以太网交换机的原理是，它检测从以太端口来的数据帧的源和目的地的MAC (介质访问层） 地址，然后与系统内部的**动态查找表**（自学习）进行比较，若数据帧的MAC 地址不在查找表中，则将该地址加入查找表，并将数据帧发送给相应的目的端口。

### 以太网交换机的特点

1.  以太网交换机的每个端口都直接与单台主机相连（普通网桥的端口往往连接到以太网的一个网段），并且一般都工作在全双工方式。
2.  以太网交换机能同时连通许多对端口，使每对相互通信的主机都能像独占通信媒体那样，无碰撞地传输数据。
3.  以太网交换机也是一种即插即用设备（和透明网桥一样），其内部的帧的转发表也是通过自学习算法自动地逐渐建立起来的。
4.  以太网交换机由于使用了专用的交换结构芯片，因此交换速率较高。
5.  以太网交换机独占传输媒体的带宽。

> 对于普通l0Mb/s 的共享式以太网，若共有N 个用户，则每个用户占有的平均带宽只有总带 宽(l0Mb/s) 的1/N。在使用以太网交换机时，虽然从每个端口到主机的带宽还是10Mb/s, 但由于一个用户在通信时是独占而不是和其他网络用户共享传输媒体的带宽，因此拥有N 对端口的交换机的总容量为N\*10Mb/s 。这正是交换机的最大优点。  
> 以太网交换机一般都具有多种速率的端口，例如可以具有10Mb/s 、l00Mb/s 和lGb/s 的端口的各种组合，因此大大方便了各种不同情况的用户。

### 以太网交换机的两种交换模式

*   直通式交换机只检查帧的目的地址，这使得帧在接收后几乎能马上被传出去。这种方式速度快，但缺乏智能性和安全性，也无法支持具有不同速率的端门的交换。
    
*   存储转发式交换机先将接收到的帧缓存到高速缓存器中，并检查数据是否正确，确认无误后通过查找表转换成输出端口将该帧发送出去。如果发现帧有错，那么就将其丢弃。存储转发式的优点是可靠性高，并能支持不同速率端口间的转换，缺点是延迟较大。

# 网络层设备
路由器
---

![](https://img-blog.csdnimg.cn/20200807174517586.png?)
  
路由器是一种具有**多个输入／输出端口的专用计算机**，其任务是连接不同的网络（**连接异构网络**）并完成路由转发。在多个逻辑网络（即**多个广播域**）互联时必须使用路由器。

> 这里说路由器是一种具有多个输入／输出端口的专用计算机，所以只要安装相关的软件，使普通的电脑也可以变成路由器，如m0n0wall 、GNU Zebra；绝大多数UNIX类的操作系统包含所有进行路由所必须的软件。

当源主机要向目标主机发送数据报时，路由器先检查源主机与目标主机是否连接在同一个网络上。如果源主机和目标主机在同一个网络上，那么**直接交付**而无须通过路由器。如果源主机和目标主机不在同一个网络上，那么路由器按照转发表（路由表）指出的路由将数据报转发给下一个路由器，这称为**间接交付**。可见，**在同一个网络中传递数据无须路由器的参与**，而跨网络通信必须通过路由器进行转发。例如，路由器可以连接不同的LAN, 连接不同的VLAN, 连接不同的WAN, 或者把LAN 和WAN 互联起来。路由器**隔离了广播域**。

> 注：如果一个存储转发设备实现了某个层次的功能，那么它就可以互联两个在该层次上使用不同协议的网段（网络）。如果网桥实现了物理层和数据链路层，那么网桥可以互联两个物理层和数据链路层不同的网段；但中继器实现了物理层后，却不能互联两个物理层同的网段，这是因为中继器不是存储转发设备，它属于直通式设备。

### 路由器的体系结构

![](https://img-blog.csdnimg.cn/20200807190550205.png?)
  
![](https://img-blog.csdnimg.cn/20200807195926564.png?)

路由选择部分也称控制部分，其核心构件是路由选择处理机。路由选择处理机的任务是根据 所选定的路由选择协议构造出路由表，同时经常或定期地和其他相邻路由器交换路由信息而不断更新和维护路由表。

分组转发部分由三部分组成：交换结构、一组输入端口和一组输出端口。输入端口在从物理 层接收到的比特流中提取出链路层帧，进而从帧中提取出网络层数据报，输出端口则执行恰好相反的操作。交换结构是路由器的关键部件，它根据转发表对分组进行处理，将某个输入端口进入的分组从一个合适的输出端口转发出去。有三种常用的交换方法：通过存储器进行交换、通过总线进行交换和通过互联网络进行交换。**交换结构本身就是一个网络**。

### 转发和路由选择的区别

> “转发”是路由器根据转发表把收到的IP数据报从合适的端口转发出去，它仅涉及一个路由器。  
> “路由选择”则涉及很多路由器，路由表是许多路由器协同工作的结果。这些路由器按照复杂的路由算法，根据从各相邻路由器得到的关于网络拓扑的变化情况，动态的改变所选择的路由，并由此构造出整个路由表。

### 网桥和路由器的区别

1.  网桥只能连接两个逻辑相同的网络（它相当于一个二层交换机），而路由器可以连接不同网络；网桥就是把不同物理位置的机器组成一个大的局域网，连接的多个网络属于同一个局域网；网桥连接的两个网络在逻辑上属于同一个局域网，但**可以是不同策略的网络，如以太网和令牌环网**；路由器可以连接不同的网络，连接的网络之间可以说没什么关系，是独立的；
2.  网桥**基于 MAC 地址**转发，路由器**基于 IP 转发**；
3.  网桥不隔离广播，而路由器可以隔离广播；
4.  网桥工作在链路层，路由器工作在网络层；

![](https://img-blog.csdnimg.cn/20200807174748819.png?)
  
网关（Gateway） 就是一个网络连接到另一个网络的“关口”。也就是网络关卡。

网关(Gateway)又称网间连接器、协议转换器。默认网关在网络层上以实现网络互连，是最复杂的网络互连设备，仅用于两个高层协议不同的网络互连。网关的结构也和路由器类似，不同的是互连层。网关既可以用于广域网互连，也可以用于局域网互连。

> 注：由于历史的原因，许多有关TCP/IP的文献曾经把网络层使用的路由器称为网关，在今天很多局域网采用都是路由来接入网络，因此通常指的网关就是路由器的IP！

网关实质上是一个网络通向其他网络的IP地址。

假设有网络A和网络B，网络A的IP地址范围为“192.168.1.1~192. 168.1.254”，子网掩码为255.255.255.0；网络B的IP地址范围为“192.168.2.1~192.168.2.254”，子网掩码为255.255.255.0。  
在没有路由器的情况下，两个网络之间是不能进行TCP/IP通信的，即使是两个网络连接在同一台交换机(或集线器)上，TCP/IP协议也会根据子网掩码(255.255.255.0)判定两个网络中的主机处在不同的网络里。

要实现这两个网络之间的通信，则必须通过网关。如果网络A中的主机发现数据包的目的主机不在本地网络中，就把数据包转发给它自己的网关，再由网关转发给网络B的网关，网络B的网关再转发给网络B的某个主机。网络B向网络A转发数据包的过程。

对默认网关，其意思是一台主机如果找不到可用的网关，就把数据包发给默认指定的网关，由这个网关来处理数据包。现在主机使用的网关，一般指的是**默认网关**。

网关实质上是一个网络通向其他网络的IP地址，网关在网段内的可用ip中选一个，不过，**一般用的是第1个和最后一个**。

设备是否能分离广播域或冲突域的问题
-----------------

见我的这篇文章[一张表格看懂设备是否能分离广播域或冲突域的问题](https://blog.csdn.net/Alexhcf/article/details/106301532)  
![](https://img-blog.csdnimg.cn/20200807030147740.png?)

交换机和路由器的区别
----------

交换机

*   用于同一网络内部数据的快速传输
*   转发决策通过查看二层头部完成
*   转发不需要修改数据帧
*   工作在 TCP/IP 协议的二层 —— 数据链路层
*   工作简单，直接使用硬件处理

路由器

*   用于不同网络间数据的跨网络传输
*   转发决策通过查看三层头部完成
*   转发需要修改 TTL ，IP 头部校验和需要重新计算，数据帧需要重新封装
*   工作在 TCP/IP 协议的三层 —— 网络层
*   工作复杂，使用软件处理

为什么有时候还要在路由器的后面先接1台交换机再接计算机
---------------------------

路由器是可以直接接电脑等终端设备，为什么标准都是路由器接交换机然后再接电脑等终端，是因为路由器本来就是一个路由设备，用来选路的，**不适合大量的数据交换**，交换机是用来大量数据交换的，终端在内网的性质就是需要使用交换机，所以标准就是路由器地下接交换机的形式。一般是情况就是在路由器下面接交换机，**路由器主要起数据转发，也就是寻址、路由的功能**，**交换机起到用户接入的目的**。但是家用的路由器的话直接就接计算机就可以了，而不必考虑再接交换机。